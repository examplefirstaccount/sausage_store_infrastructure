apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-scripts
data:
  init.sql: |-
    CREATE TABLE order_product
    (
        quantity integer not null,
        order_id bigint not null,
        product_id bigint not null

    );

    CREATE TABLE orders
    (
        id bigint generated by default as identity,
        date_created date,
        status varchar(255)
    );

    CREATE TABLE product
    (
        id bigint generated by default as identity,
        name varchar(255) not null,
        picture_url varchar(255),
        price double precision
    );

    ALTER TABLE product ALTER COLUMN name TYPE varchar (20);
    ALTER TABLE product ALTER COLUMN picture_url TYPE varchar (100);

    CREATE INDEX ind_orders_id ON orders USING btree (id ASC NULLS FIRST);
    CREATE INDEX ind_prod_id_order_id ON order_product USING btree (product_id NULLS FIRST, order_id NULLS FIRST);

    CREATE VIEW V_molo4naya_last AS SELECT op.order_id,status,p.name from orders o INNER JOIN (SELECT * FROM order_product  LIMIT 100)  op ON o.id = op.order_id INNER JOIN product p ON op.product_id = p.id WHERE p.id = 3;
